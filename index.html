<!DOCTYPE html>
<meta charset='utf-8'>
<head>

  <title>Floating Library</title>

  <script src='//code.jquery.com/jquery-2.2.1.min.js'></script>

  <script src='./js/regression.js'></script>


  <script src='//d3js.org/d3.v3.min.js'></script>
  <script src='//d3js.org/queue.v1.min.js'></script>

  <link rel="stylesheet" href="./style.css" />

</head>
<body>

<div id="container">
  <div id="displacementGraphics" class='section'>
    <div class='narrative'>
      <h2>Floating Library Distribution</h2>
      <h3>How well mixed are the floating collections?</h3>
      <p>Compare the distribution of floating books from home libraries to current locations.</p>
    </div>
    <div class='narrative'>
      <h4>How understocked are books from certain home libraries in their current library locations?</h4>
    </div>
    <div id="lineGraphContainer">
      <div id="homeCheckboxes" class='selectorList'>
        <p class='label'>Home</p>
        <p class='allLibrariesSelector checkboxContainer'>
          <input id='homeAllLibrariesSelector' type='button' value="All">
        </p>
      </div>
      <div id="currentCheckboxes" class='selectorList'>
        <p class='label'>Current</p>
        <p class='allLibrariesSelector checkboxContainer'>
          <input type='button' id='currentAllLibrariesSelector' value="All">
        </p>
      </div>
      <div id="lineGraph">
      </div>
      <div class="captions">
        <p id="lineGraphCaption1" class="caption"></p>
        <p id="lineGraphCaption2" class="caption"></p>
      </div>
    </div>
    <div class='narrative'>
      <h4>Books from Home Libraries (rows) in Current Libraries (columns)</h4>
    </div>
    <div id="matrices"></div>
  </div>

  <div id="recencyGraphics" class='section'>
    <div class='narrative'>
      <h2>Recency of Library Collections</h2>
      <h3>Has a floating system caused some libraries to lose their recently published books?</h3>
      <h4>Changing Recency of Collections</h4>
    </div>
    <p class='instructions'>Use the slider to move through time.</p>
    <input class='slider' id="recencySlider" type="range" min="0" max="17" step = "1" value="0">
    <div id="recencyBarChart"></div>
  </div>

  <div id="callNumberGraphics" class='section'>
    <div class='narrative'>
      <h2>Call Numbers</h2>
      <h3>Has a floating system caused a redistribution of books for specific subject areas?</h3>
      <h4>Changing Distribution of Call Numbers</h4>
    </div>
    <p class='instructions'>Select a call number class from the menu.</p>
    <div id='menu'>
      <div class="selector">
        Classification:
        <select id='classMenu'>
          <option value="main">Main Classes</option>
        </select>
      </div>
    </div>
    <p class='instructions'>Use the slider to move through time.</p>
    <input class='slider' id="cnSlider" type="range" min="0" max="17" step = "1" value="0">
    <div id="callNumberChart"></div>
  </div>
</div>

<script>

// List containing each library code
var libraryCodes = ['AA','AB','BR','BK','BD','DE','DS','FE','MK','HB','HN','LV','MA','NK','SL','SV','WB','WS','YK'];

// Empty variables to contain the snapshots and LOC classifications objects
var snapshots,classifications;

</script>

<!-- load view-specific scripts -->
<script src="./js/draw-displacement-graphics.js"></script>
<script src="./js/draw-recency-graphics.js"></script>
<script src="./js/draw-call-number-graphics.js"></script>

<script>

queue().defer(d3.json, 'data/snapshots.json').defer(d3.json, 'data/classifications.json').awaitAll(prepped);

var snapFormat = d3.time.format('%Y%m%d'),
  displayFormat = d3.time.format('%B, %Y');

// load each snapshot's data
function prepped(error, results) {
  if (error) throw error;
  snapshots = results[0];
  classifications = results[1];
  var waiting = queue()
  results[0].map(function(d) {
    waiting.defer(d3.json, 'data/' + d + '_displacement.json');
    waiting.defer(d3.json, 'data/' + d + '_recency.json');
    waiting.defer(d3.json, 'data/' + d + '_call_number.json');
  });
  waiting.awaitAll(ready)
}

// all ready to go
function ready(error, data) {
  if (error) throw error;

  $('.slider').attr('max', snapshots.length - 1)

  var displacementData = [],
      recencyData = [],
      callNumberData = [];

  data.map(function(d) {
    if (d.length > 0) {
      displacementData.push(d);
    };
    if (d['3 - 5 years']) {
      recencyData.push(d);
    };
    if (d['B'] && d['N']) {
      callNumberData.push(d);
    }
  });

  drawDisplacementGraphics(displacementData);
  drawRecencyGraphics(recencyData);
  drawCallNumberGraphics(callNumberData);
}

var visuals = ['displacement', 'recency', 'callNumbers'];
var visFocus = 0;
$('.menu-button').on('click', function() {
  visFocus = visuals.indexOf($(this).attr('id'));
  $('.menu-button').removeClass('focus');
  $(this).addClass('focus');

});

</script>
</body>
