<!DOCTYPE html>
<meta charset='utf-8'>
<head>
  <title>Floating Library</title>
  <script src='http://code.jquery.com/jquery-2.2.1.min.js'></script>
  <script src='./javascript/regression.js'></script>
</head>
<body>

  <link rel="stylesheet" href="style.css" />

  <!-- <div id='menu'>
    <h2 id='displacement' class='menu-button'>Distribution</h2>
    <h2 id='recency' class='menu-button'>Recency</h2>
    <h2 id='callNumbers' class='menu-button'>Call Numbers</h2>
  </div> -->

  <div class='break'></div>

  <div id="displacementGraphics">
    <h2 class='subtitle'>Floating Library Distribution</h2>
    <div id="lineGraphContainer">
      <p>Compare the distribution of floating books from home libraries to current locations.</p>
      <div id="homeCheckboxes" class='selectorList'>
        <p class='allLibrariesSelector checkboxContainer'>
          <input id='homeAllLibrariesSelector' type='button' value="All">
        </p>
      </div>
      <div id="currentCheckboxes" class='selectorList'>
        <p class='allLibrariesSelector checkboxContainer'>
          <input type='button' id='currentAllLibrariesSelector' value="All">
        </p>
      </div>
      <div id="lineGraph">
      </div>
      <div class="captions">
        <p id="lineGraphCaption1" class="caption"></p>
        <p id="lineGraphCaption2" class="caption"></p>
      </div>
    </div>
    <div id="matrices"></div>
  </div>

  <div class='break'></div>

  <div id="recencyGraphics">
    <h2 class='subtitle'>Recency of Library Collections</h2>
    <p class='instructions'>Use the slider to move through time.</p>
    <input class='slider' id="recencySlider" type="range" min="0" max="17" step = "1" value="0">
    <div id="recencyBarChart"></div>
  </div>

  <div class='break'></div>

  <div id="callNumberGraphics">
    <h2 class='subtitle'>Call Numbers</h2>
    <p class='instructions'>Select a call number class from the menu.</p>
    <div id='menu'>
      <div class="selector">
        Classification:
        <select id='classMenu'>
          <option value="main">Main Classes</option>
        </select>
      </div>
    </div>
    <p class='instructions'>Use the slider to move through time.</p>
    <input class='slider' id="cnSlider" type="range" min="0" max="17" step = "1" value="0">
    <div id="callNumberChart"></div>
  </div>

<script src='//d3js.org/d3.v3.min.js'></script>
<script src='http://d3js.org/queue.v1.min.js'></script>

<script>

var libraryCodes = ['AA','AB','BR','BK','BD','DE','DS','FE','MK','HB','HN','LV','MA','NK','SL','SV','WB','WS','YK'];
var snapshots,classifications;

</script>

<!-- load view specific scripts -->
<script src="draw-displacement-graphics.js"></script>
<script src="draw-recency-graphics.js"></script>
<script src="draw-call-number-graphics.js"></script>

<script>

queue().defer(d3.json, 'data/snapshots.json').defer(d3.json, 'data/classifications.json').awaitAll(prepped);

var snapFormat = d3.time.format('%Y%m%d'),
  displayFormat = d3.time.format('%B, %Y');

// load each snapshot's data
function prepped(error, results) {
  if (error) throw error;
  snapshots = results[0];
  classifications = results[1];
  var waiting = queue()
  results[0].map(function(d) {
    waiting.defer(d3.json, 'data/' + d + '_displacement.json');
    waiting.defer(d3.json, 'data/' + d + '_recency.json');
    waiting.defer(d3.json, 'data/' + d + '_call_number.json');
  });
  waiting.awaitAll(ready)
}

// all ready to go
function ready(error, data) {
  if (error) throw error;

  $('.slider').attr('max', snapshots.length - 1)

  var displacementData = [],
      recencyData = [],
      callNumberData = [];

  data.map(function(d) {
    if (d.length > 0) {
      displacementData.push(d);
    };
    if (d['3 - 5 years']) {
      recencyData.push(d);
    };
    if (d['B'] && d['N']) {
      callNumberData.push(d);
    }
  });

  drawDisplacementGraphics(displacementData);
  drawRecencyGraphics(recencyData);
  drawCallNumberGraphics(callNumberData);
}

var visuals = ['displacement', 'recency', 'callNumbers'];
var visFocus = 0;
$('.menu-button').on('click', function() {
  visFocus = visuals.indexOf($(this).attr('id'));
  $('.menu-button').removeClass('focus');
  $(this).addClass('focus');

});

</script>
</body>
