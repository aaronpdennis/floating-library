<!DOCTYPE html>
<meta charset='utf-8'>
<head>

  <title>Floating Library</title>

  <script src='//code.jquery.com/jquery-2.2.1.min.js'></script>

  <script src='./js/regression.js'></script>


  <script src='//d3js.org/d3.v3.min.js'></script>
  <script src='//d3js.org/queue.v1.min.js'></script>

  <link rel="stylesheet" href="./style.css" />

</head>
<body>

<div id="container">
  <div id='introduction' class='section'>
    <div class='narrative'>
      <h2>Floating Collection Analysis and Visualization</h2>
      <h3>A research assistantship project by <br>Aaron Dennis, Spring 2016</h3>
      <p>We have collected monthly snapshots of the floating collection that capture where each “book float” item is located among 19 library locations since August, 2014. With nearly one million individual items in the floating collection, the challenge is deriving insight about general trends and patterns from such a massive amount of information. This page provides a window to the floating book data and is presented here in three sections:</p>
      <ol>
        <li>Overall distribution of floating books</li>
        <li>Changes in collection recency</li>
        <li>Changes in distribution of call numbers</li>
      </ol>
      <p>
        This page is intended as an objective view into the data collected and makes no value judgement on the workings of the floating library collection. The hope is that these charts are useful to library experts in their efforts to assess and improve the floating library system.
      </p>
    </div>
  </div>
  <div id="displacementGraphics" class='section'>
    <div class='narrative'>
      <h2>Floating Library Distribution</h2>
      <h3>How well mixed are the floating collections?</h3>
      <p>The main idea of a floating collection is books move freely between library locations and are not automatically recalled to their home, or original, locations. When the floating collection started, all books resided at their home location. As users requested floating books from other libraries, the book float items began to mix. When data for this project began collection in August, 2014, books had been floating since 2011 and all libraries had books on their shelves that were originally from other library locations.
      </p>
      <p>
        Here, the original library location for a book, that library which first added the book to their collection, is referred to as the <em>home location</em> and the library location where the book currently resides at the time of the monthly snapshot is referred to as the <em>current location</em>. As of April, 2016, most books have not floated from their home location, but many have.
      </p>
      <p>
        In our analysis of book float distribution, we can think of the floating collection as a salad. Before tossing our salad, all the ingredients sit in groups in the bowl and none have yet mixed. This was the state of the floating collection in 2011. Some ingredients were in larger quantities. Books from Harrisburg, like the lettuce in the bowl, outnumbered the other ingredients. When we began tossing our salad, and books started to float, the ingredients slowly began to mix. A few pieces of tomato mixed in with the salad and croutons, just as floating books began moving to new locations. At first, the salad isn’t very well mixed, but keep tossing long enough and eventually the salad is entirely mixed and it becomes impossible to make the ingredients any more evenly distributed.
      </p>
      <p>
        This fully tossed salad is the perfect mixture and at a sort of equilibrium. Theoretically, our floating collection is also heading toward that level of equilibrium, where all books occur in other locations at proportional quantities. As you’ll see in the chart, however, some library’s books are mixing faster than others. In April 2016, all libraries are still overstocked with their own books (if the goal is a perfectly distributed collection of books). Some libraries are less overstocked than others. Possible reasons for this variation include differences in demand for their books or abnormal lending practices of some libraries.
      </p>
      <p>
        Regardless of the reason, in this section you’ll find two sets of graphics that show how well the floating books are distributed, assuming a trend toward equilibrium. The first focuses on books from selected home locations and plots how understocked they are in current library locations. Rates of change and predictions about how well mixed the books will be in August, 2019 (five years after data collection began) are presented below the chart. The second graphic provides a matrix view of each snapshot where every home library is matched up with every current library. Purple and blue squares represent overstocked and understocked levels of books respectively. Yellow is the equilibrium the matrix colors settle towards over time.
      </p>

    </div>
    <div class='narrative'>
      <h4>How understocked are books from certain home libraries in their current library locations?</h4>
    </div>
    <div id="lineGraphContainer">
      <div id="homeCheckboxes" class='selectorList'>
        <p class='label'>Home</p>
        <p class='allLibrariesSelector checkboxContainer'>
          <input id='homeAllLibrariesSelector' type='button' value="All">
        </p>
      </div>
      <div id="currentCheckboxes" class='selectorList'>
        <p class='label'>Current</p>
        <p class='allLibrariesSelector checkboxContainer'>
          <input type='button' id='currentAllLibrariesSelector' value="All">
        </p>
      </div>
      <div id="lineGraph">
      </div>
      <div class="captions">
        <p id="lineGraphCaption1" class="caption"></p>
        <p id="lineGraphCaption2" class="caption"></p>
      </div>
    </div>
    <div class='narrative'>
      <h4>Books from Home Libraries (rows) in Current Libraries (columns)</h4>
    </div>
    <div id="matrices"></div>
  </div>

  <div id="recencyGraphics" class='section'>
    <div class='narrative'>
      <h2>Recency of Library Collections</h2>
      <h3>Has a floating system caused some libraries to lose their recently published books?</h3>
      <p>
        There is reasonable concern that libraries purchasing recently published books are losing these items quickly to other libraries in the floating system and may not see them return to their shelves. The charts below show each library’s collection broken down into six classes based on publication years of books. The bars extend either above or below a black horizontal line based on whether they have more (above) or less (below) books of that recency class than are found in the entire floating collection. If each library’s collection had the same recency characteristics, we would see no variation between libraries. Bars extending upward suggest libraries have abnormally more books of that age than other libraries and bars extending down mean they have abnormally few.
      </p>
      <p>
        The slider allows you to compare recency distributions at different times in the floating collection’s history. See whether the most recent data differs significantly from the earliest recorded snapshots.
      </p>
      <h4>Changing Recency of Collections (above or below collection-wide average)<br>by Age Class</h4>
    </div>
    <p class='instructions'>Use the slider to move through time.</p>
    <input class='slider' id="recencySlider" type="range" min="0" max="17" step = "1" value="0">
    <div id="recencyBarChart"></div>
  </div>

  <div id="callNumberGraphics" class='section'>
    <div class='narrative'>
      <h2>Call Numbers</h2>
      <h3>Has a floating system caused a redistribution of books for specific subject areas?</h3>
      <p>
        There is a question of whether a floating library system has caused the accumulation of books in certain libraries based on subject material. The charts below provide a view into the data broken down into call number classifications. Trends here may be less obvious that in the graphics above, but you may find some insight for specific classes. Again, the bars extend either above or below a black horizontal line based on whether they have more (above) or less (below) books of that call number class than are typical for the entire floating collection.
      </p>
      <p>
        The slider allows you to compare call number distributions at different times in the floating collection’s history. See whether the most recent data differs significantly from the earliest recorded snapshots.
      </p>
      <h4>Changing Distribution of Call Numbers (above or below collection-wide average)<br>by Current Library</h4>
    </div>
    <p class='instructions'>Select a call number class from the menu.</p>
    <div id='menu'>
      <div class="selector">
        Classification:
        <select id='classMenu'>
          <option value="main">Main Classes</option>
        </select>
      </div>
    </div>
    <p class='instructions'>Use the slider to move through time.</p>
    <input class='slider' id="cnSlider" type="range" min="0" max="17" step = "1" value="0">
    <div id="callNumberChart"></div>
  </div>
</div>

<script>

// List containing each library code
var libraryCodes = ['AA','AB','BR','BK','BD','DE','DS','FE','MK','HB','HN','LV','MA','NK','SL','SV','WB','WS','YK'];

// Empty variables to contain the snapshots and LOC classifications objects
var snapshots,classifications;

</script>

<!-- load view-specific scripts -->
<script src="./js/draw-displacement-graphics.js"></script>
<script src="./js/draw-recency-graphics.js"></script>
<script src="./js/draw-call-number-graphics.js"></script>

<script>

queue().defer(d3.json, 'data/snapshots.json').defer(d3.json, 'data/classifications.json').awaitAll(prepped);

var snapFormat = d3.time.format('%Y%m%d'),
  displayFormat = d3.time.format('%B, %Y');

// load each snapshot's data
function prepped(error, results) {
  if (error) throw error;
  snapshots = results[0];
  classifications = results[1];
  var waiting = queue()
  results[0].map(function(d) {
    waiting.defer(d3.json, 'data/' + d + '_displacement.json');
    waiting.defer(d3.json, 'data/' + d + '_recency.json');
    waiting.defer(d3.json, 'data/' + d + '_call_number.json');
  });
  waiting.awaitAll(ready)
}

// all ready to go
function ready(error, data) {
  if (error) throw error;

  $('.slider').attr('max', snapshots.length - 1)

  var displacementData = [],
      recencyData = [],
      callNumberData = [];

  data.map(function(d) {
    if (d.length > 0) {
      displacementData.push(d);
    };
    if (d['3 - 5 years']) {
      recencyData.push(d);
    };
    if (d['B'] && d['N']) {
      callNumberData.push(d);
    }
  });

  drawDisplacementGraphics(displacementData);
  drawRecencyGraphics(recencyData);
  drawCallNumberGraphics(callNumberData);
}

var visuals = ['displacement', 'recency', 'callNumbers'];
var visFocus = 0;
$('.menu-button').on('click', function() {
  visFocus = visuals.indexOf($(this).attr('id'));
  $('.menu-button').removeClass('focus');
  $(this).addClass('focus');

});

</script>
</body>
